Contents

- [[#函数向量化|函数向量化]]
- [[#构造函数|构造函数]]
	- [[#`object(key1, value1, ...)`|`object(key1, value1, ...)`]]
	- [[#`list(value1, value2, ...)`|`list(value1, value2, ...)`]]
	- [[#`date(any)`|`date(any)`]]
	- [[#`dur(any)`|`dur(any)`]]
	- [[#`number(string)`|`number(string)`]]
	- [[#`string(any)`|`string(any)`]]
	- [[#`link(path, [display])`|`link(path, [display])`]]
	- [[#`elink(url, [display])`|`elink(url, [display])`]]
- [[#数值运算|数值运算]]
	- [[#`round(number, [digits])`|`round(number, [digits])`]]
- [[#对象、数组和字符串操作|对象、数组和字符串操作]]
	- [[#`contains(object|list|string, value)`|`contains(object|list|string, value)`]]
	- [[#`extract(object, key1, key2, ...)`|`extract(object, key1, key2, ...)`]]
	- [[#`sort(list)`|`sort(list)`]]
	- [[#`reverse(list)`|`reverse(list)`]]
	- [[#`length(object|array)`|`length(object|array)`]]
	- [[#`sum(array)`|`sum(array)`]]
	- [[#`all(array)`|`all(array)`]]
	- [[#`any(array)`|`any(array)`]]
	- [[#`none(array)`|`none(array)`]]
	- [[#`join(array)`|`join(array)`]]
	- [[#`filter(array, predicate)`|`filter(array, predicate)`]]
	- [[#`map(array, func)`|`map(array, func)`]]
- [[#字符串操作|字符串操作]]
	- [[#`regexmatch(pattern, string)`|`regexmatch(pattern, string)`]]
	- [[#`regexreplace(string, pattern, replacement)`|`regexreplace(string, pattern, replacement)`]]
	- [[#`replace(string, pattern, replacement)`|`replace(string, pattern, replacement)`]]
	- [[#`lower(string)`|`lower(string)`]]
	- [[#`upper(string)`|`upper(string)`]]
	- [[#`split(string, delimiter, [limit])`|`split(string, delimiter, [limit])`]]
	- [[#`startswith(string, prefix)`|`startswith(string, prefix)`]]
	- [[#`endswith(string, suffix)`|`endswith(string, suffix)`]]
	- [[#`padleft(string, length, [padding])`|`padleft(string, length, [padding])`]]
	- [[#`padright(string, length, [padding])`|`padright(string, length, [padding])`]]
- [[#实用功能|实用功能]]
	- [[#`default(field, value)`|`default(field, value)`]]
	- [[#`choice(bool, left, right)`|`choice(bool, left, right)`]]
	- [[#`striptime(date)`|`striptime(date)`]]
	- [[#`localtime(date)`|`localtime(date)`]]
	- [[#`meta(link)`|`meta(link)`]]
		- [[#`meta(link).display`|`meta(link).display`]]
		- [[#`meta(link).embed`|`meta(link).embed`]]
		- [[#`meta(link).path`|`meta(link).path`]]
		- [[#`meta(link).subpath`|`meta(link).subpath`]]
		- [[#`meta(link).type`|`meta(link).type`]]


# 函数

Dataview 函数提供了更高级的方法来操作数据。

## 函数向量化

大多数函数既可以应用于单个值（如`number`、`string`、`date`等），也可以应用于这些值的列表。如果将函数应用于列表，则在将函数应用于列表中的每个元素后，它也会返回一个列表。例如：

`lower("YES") = "yes"
lower(list("YES", "NO")) = list("yes", "no")
replace("yes", "e", "a") = "yas"
replace(list("yes", "ree"), "e", "a") = list("yas", "raa")` 

## 构造函数

创造值的构造函数。

### `object(key1, value1, ...)`

使用给定的键和值创建一个新对象。键和值应该在调用中交替，键应该始终是字符串/文本。

`object() => empty object
object("a", 6) => object which maps "a" to 6
object("a", 4, "c", "yes") => object which maps a to 4, and c to "yes"` 

### `list(value1, value2, ...)`

创建一个包含给定值的新列表。

`list() => empty list
list(1, 2, 3) => list with 1, 2, and 3
list("a", "b", "c") => list with "a", "b", and "c"` 

### `date(any)`

如果可能，从提供的字符串、日期或链接对象解析日期，否则返回 null。

`date("2020-04-18") = <date object representing April 18th, 2020>
date([[2021-04-16]]) = <date object for the given page, refering to file.day>` 

### `dur(any)`

从提供的字符串或持续时间解析持续时间，失败时返回 null。

`dur(8 minutes) = <8 minutes>
dur("8 minutes, 4 seconds") = <8 minutes, 4 seconds>
dur(dur(8 minutes)) = dur(8 minutes) = <8 minutes>` 

### `number(string)`

从给定字符串中解析出第一个数字，返回它。如果字符串中没有数字，则返回 null。

`number("18 years") = 18
number(34) = 34
number("hmm") = null` 

### `string(any)`

将任何值转换为“合理”的字符串表示形式。与直接在查询中使用值相比，这有时会产生不那么漂亮的结果——它主要用于将日期、持续时间、数字等强制转换为字符串以进行操作。

`string(18) = "18"
string(dur(8 hours)) = "8 hours"
string(date(2021-08-15)) = "August 15th, 2021"` 

### `link(path, [display])`

从给定的文件路径或名称构造一个链接对象。如果提供了两个参数，则第二个参数是链接的显示名称。

`link("Hello") => link to page named 'Hello'
link("Hello", "Goodbye") => link to page named 'Hello', displays as 'Goodbye'` 

### `elink(url, [display])`

构造一个指向外部 url 的链接（如`www.google.com`）。如果提供了两个参数，则第二个参数是链接的显示名称。

`elink("www.google.com") => link element to google.com
elink("www.google.com", "Google") => link element to google.com, displays as "Google"` 

---

## 数值运算

### `round(number, [digits])`

将数字四舍五入到给定的位数。如果未指定第二个参数，则四舍五入到最接近的整数；否则，四舍五入到给定的位数。

`round(16.555555) = 7
round(16.555555, 2) = 16.56` 

--

## 对象、数组和字符串操作

操作容器对象内部的值的操作。

### `contains(object|list|string, value)`

检查给定的容器类型是否具有给定的值。根据第一个参数是对象、列表还是字符串，此函数的行为略有不同。

-   对于对象，检查对象是否具有给定名称的键。例如，
    
    `contains(file, "ctime") = true
    contains(file, "day") = true (if file has a date in its title, false otherwise)` 
    
-   对于列表，检查是否有任何数组元素等于给定值。例如，
    
    `contains(list(1, 2, 3), 3) = true
    contains(list(), 1) = false` 
    
-   对于字符串，检查给定值是否是字符串的子字符串（即，在字符串内部）。
    
    `contains("hello", "lo") = true
    contains("yes", "no") = false` 
    

### `extract(object, key1, key2, ...)`

从一个对象中提取多个字段，创建一个仅包含这些字段的新对象。

`extract(file, "ctime", "mtime") = object("ctime", file.ctime, "mtime", file.mtime)
extract(object("test", 1)) = object()` 

### `sort(list)`

对列表进行排序，按排序顺序返回一个新列表。

`sort(list(3, 2, 1)) = list(1, 2, 3)
sort(list("a", "b", "aa")) = list("a", "aa", "b")` 

### `reverse(list)`

反转一个列表，以相反的顺序返回一个新列表。

`reverse(list(1, 2, 3)) = list(3, 2, 1)
reverse(list("a", "b", "c")) = list("c", "b", "a")` 

### `length(object|array)`

返回对象中的字段数或数组中的条目数。

`length(list()) = 0
length(list(1, 2, 3)) = 3
length(object("hello", 1, "goodbye", 2)) = 2` 

### `sum(array)`

对数组中的所有数值求和

`sum(list(1, 2, 3)) = 6` 

### `all(array)`

`true`仅当数组中的所有值都为真时才返回。您还可以将多个参数传递给此函数，在这种情况下，它`true`仅在所有参数都为真时才返回。

`all(list(1, 2, 3)) = true
all(list(true, false)) = false
all(true, false) = false
all(true, true, true) = true` 

### `any(array)`

`true`如果数组中的任何值是真实的，则返回。您还可以将多个参数传递给此函数，在这种情况下，`true`如果任何参数为真，它就会返回。

`any(list(1, 2, 3)) = true
any(list(true, false)) = true
any(list(false, false, false)) = false
all(true, false) = true
all(false, false) = false` 

### `none(array)`

`true`如果数组中没有一个值是真实的，则返回。

`none([]) = true
none([false, false]) = true
none([false, true]) = false
none([1, 2, 3]) = false` 

### `join(array)`

将数组中的元素连接到单个字符串中（即，将它们全部呈现在同一行上）。如果提供了第二个参数，则每个元素将由给定的分隔符分隔。

`join(list(1, 2, 3)) = "1, 2, 3"
join(list(1, 2, 3), " ") = "1 2 3"
join(6) = "6"
join(list()) = ""` 

### `filter(array, predicate)`

根据谓词过滤数组中的元素，返回匹配的元素的新列表。

`filter([1, 2, 3], (x) => x >= 2) = [2, 3]
filter(["yes", "no", "yas"], (x) => startswith(x, "y")) = ["yes", "yas"]` 

### `map(array, func)`

将函数应用于数组中的每个元素，返回映射结果的列表。

`map([1, 2, 3], (x) => x + 2) = [3, 4, 5]
map(["yes", "no"], (x) => x + "?") = ["yes?", "no?"]` 

---

## 字符串操作

### `regexmatch(pattern, string)`

检查给定字符串是否与给定模式匹配（使用 JavaScript 正则表达式引擎）。

`regexmatch("\w+", "hello") = true
regexmatch(".", "a") = true
regexmatch("yes|no", "maybe") = false` 

### `regexreplace(string, pattern, replacement)`

用,替换_正则表达式_ `pattern`匹配的所有实例。这在底层使用了 JavaScript 替换方法，因此您可以使用特殊字符，例如引用第一个捕获组，依此类推。`string``replacement``$1`

`regexreplace("yes", "[ys]", "a") = "aea"
regexreplace("Suite 1000", "\d+", "-") = "Suite -"` 

### `replace(string, pattern, replacement)`

`pattern`将in的所有实例替换`string`为`replacement`。

`replace("what", "wh", "h") = "hat"
replace("The big dog chased the big cat.", "big", "small") = "The small dog chased the small cat."
replace("test", "test", "no") = "no"` 

### `lower(string)`

将字符串转换为全部小写。

`lower("Test") = "test"
lower("TEST") = "test"` 

### `upper(string)`

将字符串转换为全部大写。

`upper("Test") = "TEST"
upper("test") = "TEST"` 

### `split(string, delimiter, [limit])`

在给定的分隔符字符串上拆分字符串。如果提供了第三个参数，它会限制发生的拆分次数。分隔符字符串被解释为正则表达式。如果分隔符中有捕获组，则将匹配项拼接到结果数组中，不匹配的捕获项为空字符串。

`split("hello world", " ") = list("hello", "world")
split("hello  world", "\s") = list("hello", "world")
split("hello there world", " ", 2) = list("hello", "there")
split("hello there world", "(t?here)") = list("hello ", "there", " world")
split("hello there world", "( )(x)?") = list("hello", " ", "", "there", " ", "", "world")` 

### `startswith(string, prefix)`

检查字符串是否以给定前缀开头。

`startswith("yes", "ye") = true
startswith("path/to/something", "path/") = true
startswith("yes", "no") = false` 

### `endswith(string, suffix)`

检查字符串是否以给定的后缀结尾。

`endswith("yes", "es") = true
endswith("path/to/something", "something") = true
endswith("yes", "ye") = false` 

### `padleft(string, length, [padding])`

通过在左侧添加填充将字符串填充到所需的长度。如果省略填充字符，则默认使用空格。

`padleft("hello", 7) = "  hello"
padleft("yes", 5, "!") = "!!yes"` 

### `padright(string, length, [padding])`

等效于`padleft`，但改为向右填充。

`padright("hello", 7) = "hello  "
padright("yes", 5, "!") = "yes!!"` 

## 实用功能

### `default(field, value)`

如果`field`为空，则返回`value`；否则返回`field`。对于用默认值替换空值很有用。例如，要显示尚未完成的项目，请使用`"incomplete"`它们的默认值：

`default(dateCompleted, "incomplete")` 

默认值在两个参数中都是矢量化的；如果您需要在列表参数上显式使用 default ，请使用`ldefault`，它与 default 相同，但未矢量化。

`default(list(1, 2, null), 3) = list(1, 2, 3)
ldefault(list(1, 2, null), 3) = list(1, 2, null)` 

### `choice(bool, left, right)`

原始 if 语句 - 如果第一个参数为真，则返回左；否则，返回正确。

`choice(true, "yes", "no") = "yes"
choice(false, "yes", "no") = "no"
choice(x > 4, y, z) = y if x > 4, else z` 

### `striptime(date)`

去掉日期的时间部分，只留下年、月和日。如果您不关心时间，则适合日期比较。

`striptime(file.ctime) = file.cday
striptime(file.mtime) = file.mday` 

### `localtime(date)`

将固定时区的日期转换为当前时区的日期。

### `meta(link)`

获取包含链接元数据的对象。当您访问链接上的属性时，您得到的是链接文件中的属性值。该`meta`功能可以访问链接本身的属性。

返回的对象有几个属性`meta`：

#### `meta(link).display`

获取链接的显示文本，如果链接没有定义的显示文本，则为 null。

`meta([[2021-11-01|Displayed link text]]).display = "Displayed link text"
meta([[2021-11-01]]).display = null` 

#### `meta(link).embed`

真或假取决于链接是否为嵌入。这些是以感叹号开头的链接，例如 `![[Some Link]]`.

#### `meta(link).path`

获取链接的路径部分。

`meta([[My Project]]).path = "My Project"
meta([[My Project#Next Actions]]).path = "My Project"
meta([[My Project#^9bcbe8]]).path = "My Project"` 

#### `meta(link).subpath`

获取链接的子路径。对于文件中标题的链接，子路径将是标题的文本。对于块的链接，子路径将是块 ID。如果这些情况都不适用，则子路径将为空。

`meta([[My Project#Next Actions]]).subpath = "Next Actions"
meta([[My Project#^9bcbe8]]).subpath = "9bcbe8"
meta([[My Project]]).subpath = null` 

这可用于选择特定标题下的任务。

` ```dataview
task
where meta(section).subpath = "Next Actions"
``` ` 

#### `meta(link).type`

根据链接是链接到整个文件、文件中的标题还是文件中的块，具有值“文件”、“标题”或“块”。

`meta([[My Project]]).type = "file"
meta([[My Project#Next Actions]]).type = "header"
meta([[My Project#^9bcbe8]]).type = "block"`