### MultipartFile上传文件临时目录自动清理机制隐患

springboot上传文件时采用 MultipartFile 类型上传，上传的时候，项目会自动在临时目录中创建临时文件夹，但是操作系统会自动清理临时文件。

系统清理完临时文件之后，java项目试图删除文件的时候会出现异常：`Caused by: java.io.IOException: Cannot delete C:\Users\Administrator\AppData\Local\Temp\tomcat.8080.11446538178496553347\work\Tomcat\localhost\ROOT\upload_cb74a173_623a_4276_8853_4a0a445cf9ea_00000001.tmp`

以及`Failed to perform cleanup of multipart items`

我们可以通过指定文件上传目录来解决这个问题：

1. 采用配置类：

```java
@Configuration
public class MultipartConfig {

/**
 * 文件上传临时路径
 */
@Bean
MultipartConfigElement multipartConfigElement() {
	MultipartConfigFactory factory = new MultipartConfigFactory();
	String location = "自定义临时文件路径";
	File tmpFile = new File(location);
	if (!tmpFile.exists()) {
		tmpFile.mkdirs();
	}
	factory.setLocation(location);
	return factory.createMultipartConfig();
}
}

```

2. yml配置

```yml
#指定multipartFile临时文件存放路径，但是内置的tomcat创建的临时文件夹路径还是不变的
spring:
	servlet:
		multipart:
			location=临时文件路径

#指定springboot启动时内置tomcat创建的临时文件夹的路径
#server.tomcat.basedir=/data/ops/app/cms/cache
```
