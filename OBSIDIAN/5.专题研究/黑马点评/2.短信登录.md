
![[assets/Pasted image 20230103094108.png]]

## 发送短信验证码

在登录界面点击发送验证码，向服务器发送了一条请求

![[assets/Pasted image 20230103095601.png]]

![[assets/Pasted image 20230103095640.png]]

在后端实现请求：

Controller

```java
/**  
 * 发送手机验证码  
 */  
@PostMapping("code")  
public Result sendCode(@RequestParam("phone") String phone, HttpSession session) {  
    // TODO 发送短信验证码并保存验证码  
    return userService.sendCode(phone, session);  
}
```

Service

```java
Result sendCode(String phone, HttpSession session);
```

ServiceImpl

```java
    @Override  
    public Result sendCode(String phone, HttpSession session) {  
//        1. 提交手机号  
//        2. 校验手机号  
        if (RegexUtils.isPhoneInvalid(phone)) {  
//        3. 不符合-重新提交手机号  
            return Result.fail("手机号输入有误");  
        }  
//        4. 符合-生成验证码  
        String code = RandomUtil.randomNumbers(6);  
//        5. 保存验证码到session  
        session.setAttribute("code", code);  
//        6. 发送验证码  
        log.debug("发送验证码成功，验证码：{}", code);  
        return Result.ok();  
    }
```

这里使用了工具类RegexUtils来校验手机号，使用了RandomUtil获取随机数，使用了Slf4j日志工具类进行日志的打印输出

其中UserServiceImpl类需要在类的头部加上注解，如下

```java
@Slf4j  
@Service  
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements IUserService {
...
}
```

> [!note]
> 工具类 RegexUtils 提供了校验手机号、邮箱、验证码的正则校验函数
> 工具类 RandomUtil 是包 hutool 下的生成验证码的工具类，hutool官网 https://www.hutool.cn/docs/#/


编写完成之后再次发送验证码，成功

![[assets/Pasted image 20230103101547.png]]


