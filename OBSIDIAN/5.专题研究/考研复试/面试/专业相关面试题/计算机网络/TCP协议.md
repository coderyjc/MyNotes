TCP协议（Transmission Control Protocol）

TCP是在不可靠的IP层之上实现的可靠的数据传输协议，它主要解决传输的可靠、有序、无丢失和不重复问题。

**特点**

1. TCP是面向连接的传输层协议，TCP连接是一条逻辑连接。
2. 每一条TCP连接只能有两个端点，每一条TCP连接只能是点到点的（一对一）。
3. TCP提供可靠交付的服务，保证传送的数据无差错、不丢失、不重复且有序。
4. TCP提供全双工通信，允许通信双方的应用进程在任何时候都能发送数据，为此TCP连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据。发送缓存用来暂时存放以下数据：①发送应用程序传送给发送方TCP准备发送的数据：②TCP已发送但尚未收到确认的数据。接收缓存用来暂时存放以下数据：①按序到达但尚未被接收应用程序读取的数据；②不按序到达的数据。
5. TCP是面向字节流的，虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程序交下来的数据仅视为一连串的无结构的字节流。

TCP和UDP在发送报文时所采用的方式完全不同。UDP报文的长度由发送应用进程决定，而TCP报文的长度则根据接收方给出的窗口值和当前网络拥塞程度来决定。如果应用进程传送到TCP缓存的数据块太长，TCP就把它划分得短一些再传送；如果太短，TCP也可以等到积累足够多的字节后再构成报文段发送出去。


### 三次握手

**第一步**：客户机的TCP首先向服务器发送连接请求报文段。这个特殊报文段的首部中的同步位SYN置1，同时选择一个初始序号seq=x。

**第二步**：服务器的TCP收到连接请求报文段后，如同意建立连接，则向客户机发回确认，并为该TCP连接分配缓存和变量。在确认报文段中，把SYN位和ACK位都置1，确认号是ack=x+1，同时也为自已选择一个初始序号seq=y。

**第三步**：当客户机收到确认报文段后，还要向服务器给出确认，并为该TCP连接分配缓存和变量。确认报文段的ACK位置1，确认号ack=y+1，序号seq=x+1。

建立连接：

1. SYN=1，seq=x
2. SYN=1，ACK=1，seq=y，ack=x+1
3. ACK=1，seq=x+1，ack=y+1。

### 四次挥手

1. 客户机打算关闭连接时，向其TCP发送连接释放报文段，并停止发送数据，主动关闭TCP连接，该报文段的终止位FIN置1，序号seq=u，它等于前面已传送过的数据的最后一个字节的序号加1，FIN报文段即使不携带数据，也消耗掉一个序号。这时，TCP客户进程进入FIN-WAIT-1（终止等待1）状态。TCP是全双工的，即可以想象为一条TCP连接上有两条数据通路，发送FIN的一端不能再发送数据，即关闭了其中一条数据通路，但对方还可以发送数据。
2. 服务器收到连接释放报文段后即发出确认，确认号ack=u+1，序号seq=v，等于它前面已传送过的数据的最后一个字节的序号加1。然后服务器进入CLOSE-WAIT（关闭等待）状态。此时；从客户机到服务器这个方向的连接就释放了，TCP连接处于半关闭状态。但服务器若发送数据，客户机仍要接收，即从服务器到客户机这个方向的连接并未关闭。
3. 若服务器已经没有要向客户机发送的数据，就通知TCP释放连接，此时，其发出FIN=1的连接释放报文段。设该报文段的序号为w（在半关闭状态服务器可能又发送了一些数据），还须重复上次已发送的确认号ack=u+1。这时服务器进入LAST-ACK（最后确认）状态。
4. 客户机收到连接释放报文段后，必须发出确认。把确认报文段中的确认位ACK置1，确认号ack=w+1，序号seq=u+1。此时TCP连接还未释放，必须经过时间等待计时器设置的时间2MSL（最长报文段寿命）后，客户机才进入CLOSED（连接关闭）状态。

释放连接：

1. FIN=1，seq=u
2. ACK=1，seq=v，ack=u+1
3. FIN=1，ACK=1，seq=w，ack=u+1
4. ACK=1，seq=u+1，ack=w+1

### 举例说明什么情况适合使用 tcp 协议和 udp 协议？

1. **TCP**：
    - **特点：** 可靠的、面向连接的数据传输，确保数据的可靠性和顺序性。并且具有重传机制，保证数据的完整性。
    - **适用场景：** 适用于需要可靠传输和顺序交付的应用，如网页浏览、电子邮件传输、文件传输等。
2. **UDP**：
    - **特点**：UDP 是无连接的、不可靠的数据传输协议。支持广播和多播，能够将数据一次性发送给多个接收方。
    - **适用场景**：适用于对实时性要求较高、对数据可靠性和顺序性要求较低的应用，如实时语音通话、视频直播等。

