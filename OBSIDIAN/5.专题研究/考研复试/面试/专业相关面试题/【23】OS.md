## 【23】OS

**OS 有哪些特征、基本特征是什么？**
OS 有那几种方式将程序装入内存？
什么是通道、通道的功能？
**什么是死锁？**
**怎样预防死锁？**
**如何避免死锁？**
介绍银行家算法及其思想？
计算机是如何启动的？
程序是如何跑起来的？

> 多道程序技术是什么？为什么引入多道程序技术？

**是什么**：多道程序技术（Multiprogramming）是一种计算机系统的工作方式，它允许多个程序同时存在于内存中，并且这些程序可以同时执行。在多道程序技术下，计算机系统的处理器不会等待单个程序的所有操作完成，而是会在等待某个程序的I/O操作时切换到执行另一个程序，从而实现了多个程序的并发执行。

**优点**：资源利用率高，多道程序共享计算机资源，从而使各种资源得到充分利用；系统吞吐量大，CPU和其他资源保持“忙碌”状态。

> 计算机系统的异步性？

**是什么**：计算机系统的异步性指的是系统中各个组件或任务的执行是独立于其他组件或任务的执行，并且它们的执行速度和顺序是不可预知的，进程的执行并不是一贯到底的，而是走走停停的，这就是异步性。

1. **多任务操作系统**：在多任务操作系统中，多个进程或线程可以同时运行，它们的执行顺序和时间片分配是由操作系统调度器决定的，因此它们的执行是异步的。
2. **事件驱动编程**：GUI 应用程序中用户的鼠标点击、键盘输入等事件可以随时发生，因此事件处理程序的执行是异步的。
3. **并发编程**：在并发编程中，多个任务可能会同时执行，并且它们的执行顺序和时间是不可预知的。并发编程通常涉及到共享资源的访问和同步问题。

> 分时系统和实时系统的区别？

【目标、调度方式、应用领域】

- **目标**：实时操作系统的主要目标是满足对任务响应时间有严格要求的实时性应用，而分时操作系统的主要目标是允许多用户共享计算机资源，提高资源利用率。
- **调度方式**：实时操作系统采用严格的任务调度策略，保证任务在规定的时间内完成；而分时操作系统采用分时调度的方式，让多个用户的任务轮流执行。
- **应用领域**：实时操作系统主要应用于对任务响应时间有严格要求的领域，如航空航天、汽车电子、工业控制等；而分时操作系统主要应用于多用户共享计算机资源的环境，如个人电脑、服务器等。

> 什么是管态？什么是目态？它们与进程运行状态的关系是什么？

**定义**：目态是用户态，管态是核心态。操作系统内核工作在核心态，而用户程序工作在用户态。

**关系**：系统不允许用户程序实现核心态的功能，但是用户程序必须使用这些功能，当用户程序需要使用核心态的功能的时候，就会主动执行trap指令发起系统调用，请求系统提供服务。系统通过硬件中断机制进入核心态，运行*管理程序*。还有一种情况就是程序运行出现异常情况，被动地需要管理程序的服务，这时就通过异常处理来进入核心态。

*扩展：列举相关的管理程序？*
1. 设备管理。完成设备的启动，请求或释放；
2. 文件管理。完成文件的读、写、创建及删除等功能。
3. 进程控制。完成进程的创建、撤销、阻塞及唤醒等功能。
4. 进程通信。完成进程之间的消息传递或信号传递等功能。
5. 内存管理。完成内存的分配、回收等功能。

> 介绍一下作业与作业步？

**作业**：作业是一个比程序更为广泛的概念，包含通常的程序和数据，还有一份作业说明书。系统根据该说明书来对程序的运行进行控制。  

**作业步**：在作业运行期间，每个作业都必须经过若干个相对独立，又相互关联的顺序加工步骤才得到结果，其中的每一个加工步骤称为一个作业步。
 
> 库函数和系统调用的区别和联系？

**库函数**：库函数是由**编程语言或操作系统**提供的一组函数，用于执行常见的任务或操作，如输入输出函数、内存分配函数等。库函数的调用是由用户程序直接发起的，不一定要进入内核态执行。
**系统调用**：系统调用是**操作系统**提供给用户程序访问操作系统核心功能的接口。它们允许用户程序请求操作系统执行特权操作，如文件操作、进程控制。
**联系**：库函数是可以包含系统调用的，也就是说，库函数实现了更高层次的抽象。

> 可封闭性和可再现性？

**可再现性**：指只要程序执行时的环境和初始条件相同，当程序重复执行时，不论是它从头到尾不停顿地执行，还是“停停走走”地执行，都将获得相同的结果。

**封闭性**：程序执行得到的最终结果由给定的初始条件决定，不受外界因素的影响

> 程序和进程的关系？

1. **【动静】** 而程序是一组有序的指令集合，是一种静态的概念。进程是程序及其数据在计算机上的一次运行活动，是一个动态的概念。
2. **【存在】** 进程是程序的一次执行过程，它是动态地创建和消亡的，具有一定的生命周期，是暂时存在的；而程序则是一组代码的集合，是永久存在的，可长期保存。
3. **【包含】** 一个进程可以执行一个或几个程序，一个程序也可构成多个进程。进程可创建进程，而程序不可能形成新的程序。
4. **【组成】** 进程与程序的组成不同。进程的组成包括数据和PCB，而程序是由一系列的指令和数据组成的。

> **谈谈什么是PCB**

**是什么**：进程控制块（Process Control Block，PCB）是进程实体的一部分，是进程存在的唯一标志。系统利用PCB来描述进程的基本情况和运行状态，进而控制和管理进程。比如创建进程，实质上是创建进程实体中的PCB；而撤销进程，实质上是撤销进程的PCB。

可以将PCB看成一种数据结构，他包含了这个进程拥有的一些信息：

1. 进程描述信息。进程标识符：标志各个进程，每个进程都有一个唯一的标识号。用户标识符：进程归属的用户，用户标识符主要为共享和保护服务。
2. 进程控制和管理信息。进程当前状态：描述进程的状态信息，作为处理机分配调度的依据。进程优先级：描述进程抢占处理机的优先级，优先级高的进程可优先获得处理机。
3. 资源分配清单，用于说明有关内存地址空间或虚拟地址空间的状况，所打开文件的列表和所使用的输入/输出设备信息。
4. 处理机相关信息，也称处理机的上下文，主要指处理机中各寄存器的值。当进程被切换时，处理机状态信息都必须保存在相应的PCB中，以便在该进程重新执行时，能从断点继续执行。

> 举例解释一下同步和互斥？

1. **同步（Synchronization）**：同步指的是多个线程之间按照一定的顺序协调执行。例如，当多个线程需要访问共享资源时，为了避免竞态条件和数据不一致的问题，可以使用同步机制来确保只有一个线程能够访问共享资源，或者在访问之前对共享资源进行加锁。常见的同步机制包括互斥锁、信号量、条件变量等。
    **举例**：银行取钱的例子。多个客户同时读取账户余额并进行更新操作，由于读取和更新不是原子操作，可能会导致多个客户同时读取到相同的余额并对其进行更新，而不是基于最新的余额进行更新，导致最终结果不正确。
    
2. **互斥（Mutual Exclusion）**：互斥指的是对共享资源的访问进行排他性控制，即同一时刻只允许一个线程访问共享资源，其他线程需要等待。互斥可以避免多个线程同时修改共享资源导致的数据不一致问题。
    **举例**：sum++的问题。


> 解释一下管程是什么？

管程（Monitor）是一种进程同步工具，旨在解决多线程间的同步与互斥问题。

它包含了一组共享资源及对这些资源的操作，以及一组条件变量，用于线程间的通信和同步。管程提供了一种结构化的方法来管理共享资源的访问，以确保线程间的安全性和正确性。

> 为了实现重定位需要哪些硬件？

基址寄存器（Base Register）和限长寄存器（Limit Register）

- 基址寄存器存储了程序或数据在内存中的**最小物理地址**，而限长寄存器则存储了程序或数据**所占用的内存空间的长度**。
- 当程序或数据需要被加载到内存时，基址寄存器和限长寄存器能够指定加载到内存的具体位置和长度，从而实现重定位。

进一步：*基址寄存器和限长寄存器如何实现内存保护？*

1. **访存操作**：
    - 当程序或数据需要访问内存时，CPU会将要访问的地址（逻辑地址）与基址寄存器中存储的基址相加，得到物理地址。
    - 同时，CPU会检查物理地址是否小于限长寄存器中存储的限长值，以确保访问的地址在指定的内存范围内。
2. **内存访问权限**：
    - 如果访问的地址在指定的内存范围内（即物理地址小于基址加上限长），则访问被允许，CPU会执行相应的读取或写入操作。
    - 如果访问的地址超出了指定的内存范围，CPU会产生一个异常（例如内存访问越界异常），操作系统会相应地处理这个异常，通常会终止相关进程或线程，以防止非法的内存访问。

> 虚拟存储器是什么，有什么特征？

**虚拟内存** 是计算机系统内存管理的一种技术。它使得应用程序认为它拥有连续可用的内存（一个连续完整的地址空间），而实际上物理内存通常被分隔成多个内存碎片，还有部分暂时存储在外部磁盘存储器上，在需要时进行数据交换。

三个特征：
1. **多次性。** 是指作业运行时无需一次性地全部装入内存，而允许被分成多次调入内存运行，即只需将当前要运行的那部分程序和数据装入内存即可开始运行。以后每当要运行到尚未调入的那部分程序时，再将它调入。多次性是虚拟存储器**最重要的特征**。
2. **对换性。** 是指无须在作业运行时一直常驻内存，在进程运行期间，允许将那些暂不使用的程序和数据从内存调至外存的对换区（换出），待以后需要时再将它们从外存调至内存（换进）。正是由于对换性，才使得虚拟存储器得以正常运行。
3. **虚拟性。** 是指**从逻辑上扩充内存**的容量，使用户所看到的内存容量远大于实际的内存容量。这是虚拟存储器所表现出的**最重要特征**，也是实现虚拟存储器的最重要目标。

> 分页与分段的区别与联系？

区别：
1. **目的**：分页仅是系统管理上的需要，是为实现离散分配方式，以提高内存的利用率。而不是用户的需要；段是信息的逻辑单位，它含有一组意义相对完整的信息。分段的目的是能更好地满足用户的需要。
2. **长度**：页的大小固定且由系统决定，由系统把逻辑地址划分为页号和页内地址两部分，是由机器硬件实现的；段的长度不固定，决定于用户所编写的程序，通常由编译程序在编译时根据信息的性质来划分。
3. **地址空间**：分页的程序地址空间是一维的，即单一的线性地址空间，程序员利用一个记忆符即可表示一个地址；分段的程序地址空间是二维的，程序员在标识一个地址时，既需给出段名，又需给出段内地址。
4. **碎片**：有内部碎片，无外部碎片；分段有外部碎片，无内部碎片。

> 分页的硬件支持？

1. **页表（Page Table）**：页表是分页技术中最重要的硬件数据结构之一，用于将进程的逻辑地址映射到物理内存中的页框。页表通常是一个表格，其中包含了每个页的映射信息，如页号、页框号以及其他控制信息。
2. **地址转换机制**：硬件需要支持地址转换机制，将进程的逻辑地址转换为对应的物理地址。
3. **TLB**：为了加速地址转换过程，硬件通常会实现一个地址转换缓存，如页表项缓存（Translation Lookaside Buffer，TLB）。TLB 存储了最近使用的页表项，可以避免每次访问都要访问内存中的页表，提高了地址转换的速度。

